<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NovaCorp - Anmeldung</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
    />
    <link href="./styles.css" rel="stylesheet" />
  </head>
  <body class="custom-body">
    <header class="custom-header fixed-top">
      <div class="container-fluid d-flex align-items-center">
        <span class="brand">NovaCorp</span>
      </div>
    </header>
    <div class="container">
      <div
        class="flex-grow-1 d-flex justify-content-center align-items-center min-vh-100"
      >
        <div id="errorMsg" class="w-100 mb-3"></div>
        <div class="card shadow p-4 custom-card">
          <h3 class="text-center mb-3">Anmeldung</h3>

          <form id="loginForm">
            <div class="mb-3">
              <label for="username" class="form-label">Benutzername</label>
              <input
                type="text"
                class="form-control"
                id="username"
                name="username"
                placeholder="Benutzernamen eingeben"
                required
              />
            </div>
            <div class="mb-3 position-relative">
              <label for="password" class="form-label">Passwort</label>
              <div class="input-group">
                <input
                  type="password"
                  class="form-control"
                  id="password"
                  name="password"
                  placeholder="Passwort eingeben"
                  required
                />
                <span
                  id="togglePassword"
                  class="input-group-text"
                  style="cursor: pointer"
                >
                  <i class="bi bi-eye"></i>
                </span>
              </div>
            </div>
            <div class="hint-container d-flex justify-content-end mb-3">
              <small
                class="text-muted custom-hint"
                data-bs-toggle="tooltip"
                data-bs-placement="right"
                title="Bitte kontaktieren Sie die IT-Abteilung, um ihr Passwort zurücksetzen zu lassen"
              >
                Password vergessen?
              </small>
            </div>
            <button
              type="submit"
              class="btn btn-primary w-100 custom-login-button"
            >
              Bestätigen
            </button>
          </form>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="http://localhost:1516/livereload.js?snipver=1"></script>

    <script>
      document
        .getElementById("togglePassword")
        .addEventListener("click", function () {
          var passwordInput = document.getElementById("password");
          var currentType = passwordInput.getAttribute("type");

          if (currentType === "password") {
            passwordInput.setAttribute("type", "text");
            this.querySelector("i").classList.remove("bi-eye");
            this.querySelector("i").classList.add("bi-eye-slash");
          } else {
            passwordInput.setAttribute("type", "password");
            this.querySelector("i").classList.remove("bi-eye-slash");
            this.querySelector("i").classList.add("bi-eye");
          }
        });
      var tooltipTriggerList = [].slice.call(
        document.querySelectorAll('[data-bs-toggle="tooltip"]')
      );
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });

      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          document.getElementById("errorMsg").innerHTML = "";

          // Eingaben abrufen
          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;

          try {
            const response = await fetch("/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ username, password }),
            });

            if (response.redirected) {
              window.location.href = response.url;
              return;
            }

            if (!response.ok) {
              const data = await response.json();
              const errorText =
                data.error || data.message || "An error occurred";
              document.getElementById("errorMsg").innerHTML =
                '<div class="alert alert-danger" role="alert">' +
                errorText +
                "</div>";
            }
          } catch (error) {
            console.error("Error during login:", error);
            document.getElementById("errorMsg").innerHTML =
              '<div class="alert alert-danger" role="alert">Unexpected error occurred.</div>';
          }
        });
    </script>
  </body>
</html>
